

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Release 1.0.3 &mdash; lewis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Release 1.1" href="release_1_1_0.html" />
    <link rel="prev" title="Release 1.0.2" href="release_1_0_2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lewis
              <img src="../_static/lewis-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/adapter_specifics.html">Adapter Specifics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/command_line_tools.html">Command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/remote_access_devices.html">Remote Access to Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/remote_access_simulation.html">Remote Access to Simulation Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/usage_with_python.html">Usage with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/developing_lewis.html">Developing Lewis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/framework_details.html">Framework Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/release_checklist.html">Release Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/writing_devices.html">Writing Device Simulators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release notes</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="release_notes.html">Release notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="release_1_0_0.html">Release 1.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_0_1.html">Release 1.0.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_0_2.html">Release 1.0.2</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Release 1.0.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#command-line-interface-change">Command line interface change</a></li>
<li class="toctree-l3"><a class="reference internal" href="#new-features">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bug-fixes-and-other-improvements">Bug fixes and other improvements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#upgrade-guide">Upgrade Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release_1_1_0.html">Release 1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_1_1.html">Release 1.1.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_2_0.html">Release 1.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_2_1.html">Release 1.2.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_2_2.html">Release 1.2.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_3_0.html">Release 1.3.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_3_1.html">Release 1.3.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_3_2.html">Release 1.3.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_1_3_3.html">Release 1.3.3</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lewis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="release_notes.html">Release notes</a></li>
      <li class="breadcrumb-item active">Release 1.0.3</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/lewis/blob/main/doc/release_notes/release_1_0_3.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="release-1-0-3">
<h1>Release 1.0.3<a class="headerlink" href="#release-1-0-3" title="Link to this heading"></a></h1>
<p>This version was released on March 24th, 2017. In this release, the <code class="docutils literal notranslate"><span class="pre">lewis.adapters.epics</span></code>-
module has received some updates. Some important groundwork for future improvements has been
laid as well, which resulted in the ability to switch device setups at runtime via the control
server and a new command line syntax for configuring communications. The control server and client
have been improved as well.</p>
<section id="command-line-interface-change">
<h2>Command line interface change<a class="headerlink" href="#command-line-interface-change" title="Link to this heading"></a></h2>
<p>The way options are passed to the adapters has changed completely, the functionality has been
merged into the <code class="docutils literal notranslate"><span class="pre">-p</span></code>-argument, which has a new long version now, <code class="docutils literal notranslate"><span class="pre">--adapter-options</span></code>.</p>
<p>For the default adapter options, it is still possible to use the <code class="docutils literal notranslate"><span class="pre">lewis</span></code>-command with <code class="docutils literal notranslate"><span class="pre">-p</span></code>
in the same way as before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis -p stream linkam_t95
</pre></div>
</div>
<p>To supply options, such as the address and port to bind to, the argument accepts an extended
dictionary syntax now:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis linkam_t95 -p &quot;stream: {bind_address: localhost, port: 9998}&quot;
</pre></div>
</div>
<p>The space after each colon is significant, it can not be left out. For strings containing
special characters, such as colons, it is necessary to quote them:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis chopper -p &quot;epics: {prefix: &#39;PREF:&#39;}&quot;
</pre></div>
</div>
<p>To see what options can be specified, use the new <code class="docutils literal notranslate"><span class="pre">-L/--list-adapter-options</span></code> flag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis chopper -p epics -L
</pre></div>
</div>
</section>
<section id="new-features">
<h2>New features<a class="headerlink" href="#new-features" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Writing devices with an EPICS interface has been made more convenient for cases where the device
does not have properties, but does have getter and setter methods.
<code class="docutils literal notranslate"><span class="pre">lewis.adapters.epics.PV</span></code> has been extended to accept a wider range of values for
<code class="docutils literal notranslate"><span class="pre">target_property</span></code> and <code class="docutils literal notranslate"><span class="pre">meta_data_property</span></code>, for example method names:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>     <span class="k">class</span> <span class="nc">FooDevice</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
         <span class="n">_foo</span> <span class="o">=</span> <span class="mi">3</span>

         <span class="k">def</span> <span class="nf">get_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_foo</span> <span class="o">*</span> <span class="mi">3</span>

     <span class="k">class</span> <span class="nc">FooDeviceInterface</span><span class="p">(</span><span class="n">EpicsAdapter</span><span class="p">):</span>
         <span class="n">pvs</span> <span class="o">=</span> <span class="p">{</span>
             <span class="s1">&#39;Foo&#39;</span><span class="p">:</span> <span class="n">PV</span><span class="p">(</span><span class="s1">&#39;get_foo&#39;</span><span class="p">)</span>
         <span class="p">}</span>
</pre></div>
</div>
<p>For read/write cases, a tuple of names can be supplied. Instead of method names it is also
allowed to specify callables, for example functions or lambda expressions. In that case, the
signature of the function is checked. See also the new example in
<code class="docutils literal notranslate"><span class="pre">lewis.examples.epics_device</span></code>.</p>
<ul class="simple">
<li><p>The device setup (specified in the <code class="docutils literal notranslate"><span class="pre">setups</span></code>-dict or module inside the device module)
can be changed at runtime through the control server. It is not possible to switch to
another device, only setups of the same device can be used. To query available setups:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   $ lewis-control simulation setups
</pre></div>
</div>
<p>Then, to actually activate the new setup, assuming it is called <code class="docutils literal notranslate"><span class="pre">new_setup</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   $ lewis-control simulation switch_setup new_setup
</pre></div>
</div>
<ul>
<li><p>It has been made easier to deposit devices in an external module while maintaining control over
compatibility with the rest of the Lewis-framework. Lewis now checks for a version specification
in each device module against the framework version before obtaining devices, adapters and
setups from it. Please add such a version specification to your devices.</p>
<p>This way using devices from different sources becomes more reliable for users with different
versions of Lewis, or hint them to update. By default, Lewis won’t start if a device specifies
another framework version, but this behavior can be overridden by using the new flag
<code class="docutils literal notranslate"><span class="pre">-R/--relaxed-versions</span></code>:</p>
<p>In this case the simulation will start, but a warning will still be logged so that this can be
identified as a potential source of errors later on.</p>
</li>
<li><p>A new flag <code class="docutils literal notranslate"><span class="pre">-V/--verify</span></code> has been added to the <code class="docutils literal notranslate"><span class="pre">lewis</span></code>-script. When activated, it sets
the output level to <code class="docutils literal notranslate"><span class="pre">debug</span></code> and exits before actually starting the simulation. This can
help diagnose problems with device modules or input parameters.</p></li>
</ul>
</section>
<section id="bug-fixes-and-other-improvements">
<h2>Bug fixes and other improvements<a class="headerlink" href="#bug-fixes-and-other-improvements" title="Link to this heading"></a></h2>
<ul>
<li><p>The functionality for disconnecting and reconnecting a device’s communication interfaces that
used to be accessible via <code class="docutils literal notranslate"><span class="pre">lewis-control</span></code> through the <code class="docutils literal notranslate"><span class="pre">simulation</span></code> has been moved into a
separate channel called <code class="docutils literal notranslate"><span class="pre">interface</span></code>. To disconnect a device use:</p>
<p>In general, more fine-grained control over the device’s communication is now possible.</p>
</li>
<li><p>Both <code class="docutils literal notranslate"><span class="pre">lewis.core.control_server.ControlServer</span></code> and
<code class="docutils literal notranslate"><span class="pre">lewis.core.control_client.ControlClient</span></code> were subject to some improvements, most
notably a settable timeout for requests was added so that incomplete requests do not cause the
client to hang anymore. In <code class="docutils literal notranslate"><span class="pre">lewis-control</span></code> script, a new <code class="docutils literal notranslate"><span class="pre">-t/--timeout</span></code> argument was added
to make use of that new functionality.</p></li>
<li><p>Only members defined as part of the device class are listed when using <code class="docutils literal notranslate"><span class="pre">lewis-control</span> <span class="pre">device</span></code>.
<code class="docutils literal notranslate"><span class="pre">lewis-control</span></code> generally no longer lists inherited framework functions such as <code class="docutils literal notranslate"><span class="pre">log</span></code>,
<code class="docutils literal notranslate"><span class="pre">add_processor</span></code>, etc.</p></li>
</ul>
</section>
<section id="upgrade-guide">
<h2>Upgrade Guide<a class="headerlink" href="#upgrade-guide" title="Link to this heading"></a></h2>
<p>The following changes have to be made to upgrade code working with Lewis <code class="docutils literal notranslate"><span class="pre">1.0.2</span></code> to work with
Lewis <code class="docutils literal notranslate"><span class="pre">1.0.3</span></code>:</p>
<ul>
<li><p>Any scripts or code starting Lewis with the old style adapter parameters need to be updated to
the new style adapter options.</p>
<p>For EPICS adapters:</p>
</li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      Old style:
      $ lewis chopper
      $ lewis chopper -p epics
      $ lewis chopper -p epics -- -p SIM:
      $ lewis chopper -- --prefix SIM:
      New style:
      $ lewis chopper
      $ lewis chopper -p epics
      $ lewis chopper -p &quot;epics: {prefix: &#39;SIM:&#39;}&quot;
</pre></div>
</div>
<p>For TCP Stream adapters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>       Old style:
       $ lewis linkam_t95
       $ lewis linkam_t95 -p stream
       $ lewis linkam_t95 -p stream -- -b 127.0.0.1 -p 9999 -t
       $ lewis linkam_t95 -- --bind_address 127.0.0.1 --port 9999 --telnet_mode
       New style:
       $ lewis linkam_t95
       $ lewis linkam_t95 -p stream
       $ lewis linkam_t95 -p &quot;stream: {bind_address: 127.0.0.1, port: 9999, telnet_mode: True}&quot;
</pre></div>
</div>
<p>For Modbus adapters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>      Old style:
      $ lewis -k lewis.examples modbus_device
      $ lewis -k lewis.examples modbus_device -p modbus
      $ lewis -k lewis.examples modbus_device -p modbus -- -b 127.0.0.1 -p 5020
      $ lewis -k lewis.examples modbus_device -- --bind_address 127.0.0.1 --port 5020
      New style:
      $ lewis -k lewis.examples modbus_device
      $ lewis -k lewis.examples modbus_device -p modbus
      $ lewis -k lewis.examples modbus_device -p &quot;modbus: {bind_address: 127.0.0.1, port: 5020}&quot;
</pre></div>
</div>
<ul class="simple">
<li><p>Devices must now specify a <code class="docutils literal notranslate"><span class="pre">framework_version</span></code> in the global namespace of their top-level
<code class="docutils literal notranslate"><span class="pre">__init__.py</span></code>, like this:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   <span class="n">framework_version</span> <span class="o">=</span> <span class="s1">&#39;1.0.3&#39;</span>
</pre></div>
</div>
<p>This will need to be updated with every release. If this version is missing or does not match
the current Lewis framework version, attempting to run the device simulation will fail with a
message informing the user of the mismatch. This can be bypassed by starting Lewis with the
following parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>   $ lewis linkam_t95 -R
   $ lewis linkam_t95 --relaxed-versions
</pre></div>
</div>
<p>Warning: in the next release, specifying <code class="docutils literal notranslate"><span class="pre">framework_version</span></code> becomes optional and
<code class="docutils literal notranslate"><span class="pre">--relaxed-versions</span></code> is renamed to <code class="docutils literal notranslate"><span class="pre">--ignore-versions</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="release_1_0_2.html" class="btn btn-neutral float-left" title="Release 1.0.2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="release_1_1_0.html" class="btn btn-neutral float-right" title="Release 1.1" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>