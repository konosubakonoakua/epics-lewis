

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Developing Lewis &mdash; lewis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Framework Details" href="framework_details.html" />
    <link rel="prev" title="Usage with Python" href="../user_guide/usage_with_python.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lewis
              <img src="../_static/lewis-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/adapter_specifics.html">Adapter Specifics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/command_line_tools.html">Command line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/remote_access_devices.html">Remote Access to Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/remote_access_simulation.html">Remote Access to Simulation Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide/usage_with_python.html">Usage with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Developing Lewis</a></li>
<li class="toctree-l1"><a class="reference internal" href="framework_details.html">Framework Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="release_checklist.html">Release Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_devices.html">Writing Device Simulators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/release_notes.html">Release notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lewis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Developing Lewis</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/lewis/blob/main/doc/developer_guide/developing_lewis.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="developing-lewis">
<h1>Developing Lewis<a class="headerlink" href="#developing-lewis" title="Link to this heading"></a></h1>
<p>Begin by checking-out the source from GitHub:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ git clone https://github.com/ISISComputingGroup/lewis.git
</pre></div>
</div>
<p>To develop Lewis, it is strongly recommended to work in a dedicated virtual environment, otherwise
it is not possible to have another version of Lewis installed system wide in parallel.</p>
<p>With the virtual environment activated, Lewis can be installed as an editable package:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ cd lewis
(lewis-dev)$ python -m pip install &quot;.[dev]&quot;
</pre></div>
</div>
<p>Now the Lewis package that resides in <code class="docutils literal notranslate"><span class="pre">lewis</span></code> can be modified, while it is still treated like a
normal package that has been installed via <code class="docutils literal notranslate"><span class="pre">pip</span></code>.</p>
<p>Alternatively, Lewis can be run from source. For this it is necessary to install the requirements first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ cd lewis
(lewis-dev)$ python -m pip install -r requirements-dev.txt
</pre></div>
</div>
<p>Either way, to make sure that everything is working as
intended, run the unit tests and check for pep8 errors, as well as build the documentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ pytest tests
(lewis-dev)$ flake8 setup.py lewis scripts system-tests tests
(lewis-dev)$ sphinx-build -W -b html docs/ docs/_build/html
</pre></div>
</div>
<p>There are also system-tests that (partially) test Lewis from the application/run-time level. These tests are based on
the <code class="docutils literal notranslate"><span class="pre">Approval</span> <span class="pre">Tests</span> <span class="pre">Framework</span> <span class="pre">&lt;https://approvaltests.com/&gt;</span></code>__ which works by comparing a program’s standard output
against a “golden master” - if the output doesn’t match then the tests fail.
For <code class="docutils literal notranslate"><span class="pre">lewis</span></code> and <code class="docutils literal notranslate"><span class="pre">lewis-control</span></code> the tests check that the programs work together correctly. For example: if a value
on a simulated device in <code class="docutils literal notranslate"><span class="pre">lewis</span></code> is changed via ``lewis-control``` then by querying the status of the device the
values can be compared against the expected status (the “golden master”). The tests can be run like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ pytest system_tests/lewis_tests.py
</pre></div>
</div>
<p>It is good practice to run these tests regularly during development and, also, look for opportunities to add
more tests. The tests will also be run via the CI system.</p>
<p>A more comprehensive way of running all tests is to use <code class="docutils literal notranslate"><span class="pre">tox</span></code>, which creates fresh virtual
environments for all of these tasks:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ tox
</pre></div>
</div>
<p>The advantage of tox is that it generates a source package from the source tree and installs
it in the virtual environments that it creates, testing closer to the thing that is actually
installed in the end. Running all the verification steps this way takes a bit longer, so during
development it might be more desirable to just run the components that are necessary.</p>
<p>Before starting development it is important to install the pre-commit hooks, so that formatting and <code class="docutils literal notranslate"><span class="pre">flake8</span></code> checks
are performed before code is committed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ pre-commit install
</pre></div>
</div>
<p>To test that the hooks are installed correctly and to run them manually use the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ pre-commit run --all-files
</pre></div>
</div>
<p>Development should happen in a separate branch. If the work is related to a specific issue,
it is good practice to include the issue number in the branch name, along with a short
summary of a few words, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ git checkout -b 123_enhance_logic_flow
</pre></div>
</div>
<p>It’s also good practice to push the branch back to github from time to time, so that other
members of the development team can see what’s going on (even before a pull request is opened):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(lewis-dev)$ git push origin 123_enhance_logic_flow
</pre></div>
</div>
<p>During development it is good practice to regularly test that changes do not break existing
or new tests. Before opening a pull request on github (which will run all the tests again
under different Python environments via the CI system), it is recommended to run tox one last time
locally, as that resembles the conditions in the CI environment quite closely.</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../user_guide/usage_with_python.html" class="btn btn-neutral float-left" title="Usage with Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="framework_details.html" class="btn btn-neutral float-right" title="Framework Details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>