

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Remote Access to Devices &mdash; lewis  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Access to Simulation Parameters" href="remote_access_simulation.html" />
    <link rel="prev" title="Command line tools" href="command_line_tools.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            lewis
              <img src="../_static/lewis-logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Quickstart</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart Guide</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="adapter_specifics.html">Adapter Specifics</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_tools.html">Command line tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Remote Access to Devices</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#accessing-the-device-communication-interface">Accessing the Device Communication Interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="#value-interpretation-and-syntax">Value Interpretation and Syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-client-python-api">Control Client Python API</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="remote_access_simulation.html">Remote Access to Simulation Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage_with_python.html">Usage with Python</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/developing_lewis.html">Developing Lewis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/framework_details.html">Framework Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/release_checklist.html">Release Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/writing_devices.html">Writing Device Simulators</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Release notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release_notes/release_notes.html">Release notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../_api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lewis</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Remote Access to Devices</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ISISComputingGroup/lewis/blob/main/doc/user_guide/remote_access_devices.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="remote-access-to-devices">
<h1>Remote Access to Devices<a class="headerlink" href="#remote-access-to-devices" title="Link to this heading"></a></h1>
<p><em>Please note that this functionality should only be used on a trusted
network.</em></p>
<p>Besides the device specific protocols, the device can be made accessible
from the outside via JSON-RPC over ZMQ. This can be achieved by passing
the <code class="docutils literal notranslate"><span class="pre">-r</span></code> option with a <code class="docutils literal notranslate"><span class="pre">host:port</span></code> string to the simulation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis chopper -r 127.0.0.1:10000 -p &quot;epics: {prefix: &#39;SIM:&#39;}&quot;
</pre></div>
</div>
<p>Now the device can be controlled via the <code class="docutils literal notranslate"><span class="pre">lewis-control.py</span></code>-script
in a different terminal window. The service can be queried to show the
available objects by not supplying an object name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control -r 127.0.0.1:10000
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-r</span></code> (or <code class="docutils literal notranslate"><span class="pre">--rpc-host</span></code>) option defaults to the value shown here,
so it will be omitted in the following examples. To get information on
the API of an object, supplying an object name without a property or
method will list the object’s API:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device
</pre></div>
</div>
<p>This will output a list of properties and methods which is available for
remote access. This may not comprise the full interface of the object
depending on the server side configuration. Obtaining the value of a
property is done like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device state
</pre></div>
</div>
<p>The same syntax is used to call methods without parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device initialize
</pre></div>
</div>
<p>To set a property to a new value, the value has to be supplied on the
command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device target_speed 100
$ lewis-control device start
</pre></div>
</div>
<p>It is possible to set multiple device parameters at once, but this goes through the simulation
itself, so that it is generic to all devices:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control simulation set_device_parameters &quot;{&#39;target_speed&#39;: 1, &#39;target_phase&#39;: 20}&quot;
</pre></div>
</div>
<p>Another case of device-related access to the simulation is switching the setup. To obtain a
list of available setups, the following command is available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control simulation setups
</pre></div>
</div>
<p>It is then possible to switch the setup to one from the list, assuming it is called <code class="docutils literal notranslate"><span class="pre">new_setup</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control simulation switch_setup new_setup
</pre></div>
</div>
<p>The setup switching process is logged.</p>
<section id="accessing-the-device-communication-interface">
<h2>Accessing the Device Communication Interface<a class="headerlink" href="#accessing-the-device-communication-interface" title="Link to this heading"></a></h2>
<p>Just as device model and communication interface are separate concepts in Lewis, these interfaces
can be controlled separately as well.</p>
<p>To query the available communication protocols, the following command is available:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control interface protocols
</pre></div>
</div>
<p>This will list all communication protocols that are currently exposing device behavior.
The following methods are available for interacting with the communication interfaces:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control interface disconnect
$ lewis-control interface connect
$ lewis-control interface is_connected
$ lewis-control interface documentation
</pre></div>
</div>
<p>Without any arguments, these methods will affect all of the device’s interfaces, but specifying
any number of valid protocol names will limit the method to those protocols. Assuming a device
has two interfaces, one for the <code class="docutils literal notranslate"><span class="pre">stream</span></code> protocol and one for <code class="docutils literal notranslate"><span class="pre">epics</span></code>, the following sequence
would disconnect both, but then only reconnect the <code class="docutils literal notranslate"><span class="pre">stream</span></code>-adapter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control interface disconnect
$ lewis-control interface connect stream
$ lewis-control interface is_connected stream
True
$ lewis-control interface is_connected
{&#39;stream&#39;: True, &#39;epics&#39;: False}
</pre></div>
</div>
<p>Disconnecting is essentially the equivalent of “cutting the cable”, no new connections
will be accepted and existing ones will be terminated.</p>
<p>To find out how to interact with any device via its usual communication channels a way would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control interface protocol
[&#39;stream&#39;, &#39;epics&#39;]
$ lewis-control interface documentation epics
[ ... long description of protocol ... ]
</pre></div>
</div>
</section>
<section id="value-interpretation-and-syntax">
<h2>Value Interpretation and Syntax<a class="headerlink" href="#value-interpretation-and-syntax" title="Link to this heading"></a></h2>
<p><code class="docutils literal notranslate"><span class="pre">lewis_control</span></code> interprets values as built-in Python literals or containers using
<code class="docutils literal notranslate"><span class="pre">ast.literal_eval</span></code>. This means any
syntax for literal evaluation supported by Python works here as well. The following are all valid
values which are interpreted as you might expect:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device float_value 12.0
$ lewis-control device float_value .5
$ lewis-control device float_value 1.23e10
$ lewis-control device int_value 123
$ lewis-control device int_value 0xDEADBEEF
$ lewis-control device int_value 010  # Value of 8 in base 8 (octal)
$ lewis-control device str_value hello_world
$ lewis-control device method_call_with_two_string_args hello world
$ lewis-control device str_value &quot;hello world&quot;
$ lewis-control device unicode_value &quot;u&#39;hello_world&#39;&quot;
$ lewis-control device list_value &quot;[1,2,3]&quot;
$ lewis-control device list_value &quot;[&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]&quot;
$ lewis-control device dict_value &quot;{&#39;a&#39;: 1, &#39;b&#39;: 2}&quot;
</pre></div>
</div>
<p>WARNING: Any value that cannot be successfully evaluated is silently converted into a
string literal instead! The following attempts turn into strings because the letters
are not quoted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ lewis-control device str_value_looks_like_dict &quot;{a: 1, b: 2}&quot;
$ lewis-control device str_value_looks_like_list &quot;[a, b, c]&quot;
</pre></div>
</div>
<p>This is done for convenience, to avoid having to double quote and/or escape quote trivial string
values to match Python syntax while also taking shell quotation and escapes into account. But it
can lead to unexpected results at times.</p>
</section>
<section id="control-client-python-api">
<h2>Control Client Python API<a class="headerlink" href="#control-client-python-api" title="Link to this heading"></a></h2>
<p>For use cases that require more flexibility and control, it is advised to write a Python script
using the API provided in <code class="docutils literal notranslate"><span class="pre">lewis.core.control_client</span></code> instead of using the command line utility.
This makes it possible to use the remote objects in a fairly transparent fashion.</p>
<p>Here is a brief example using the <code class="docutils literal notranslate"><span class="pre">chopper</span></code> device:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">lewis.core.control_client</span> <span class="kn">import</span> <span class="n">ControlClient</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">ControlClient</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="s1">&#39;10000&#39;</span><span class="p">)</span>
<span class="n">chopper</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="s1">&#39;device&#39;</span><span class="p">)</span>

<span class="n">chopper</span><span class="o">.</span><span class="n">target_speed</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">chopper</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="k">while</span> <span class="n">chopper</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="s1">&#39;stopped&#39;</span><span class="p">:</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">chopper</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>All calls, reads and assignments are synchronous and blocking in terms of the methods and
attributes they access on the server. However, much like with real devices, the behaviour of the
simulated device is asynchronous from its interface. Consequently, depending on the specific
device, some effects of calling a method may take place long after the method is called (and
returns).</p>
<p>This is why, in the above example, a loop is used to wait for <code class="docutils literal notranslate"><span class="pre">chopper.state</span></code> to change in
response to the <code class="docutils literal notranslate"><span class="pre">chopper.initialize()</span></code> call.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="command_line_tools.html" class="btn btn-neutral float-left" title="Command line tools" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="remote_access_simulation.html" class="btn btn-neutral float-right" title="Remote Access to Simulation Parameters" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright .</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>